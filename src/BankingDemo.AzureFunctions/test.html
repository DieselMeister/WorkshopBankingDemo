<html>

<head>
    <title>Bla</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
    <script>
        window.apiBaseUrl = 'http://localhost:7071';
    </script>
    <style>
        .slide-fade-enter-active,
        .slide-fade-leave-active {
            transition: all 1s ease;
        }

        .slide-fade-enter,
        .slide-fade-leave-to {
            height: 0px;
            overflow-y: hidden;
            opacity: 0;
        }
    </style>
</head>

<body>
    <p>&nbsp;</p>
    <div id="app" class="container">
        <h3>Dings</h3>
        
        <div class="row">
            <div class="col-sm">
                <div>Schau ins log</div>
            </div>
        </div>
        
        </div>

        <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@aspnet/signalr@1.0.3/dist/browser/signalr.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios@0.18.0/dist/axios.min.js"></script>

        <script>

            const username = "the-user"

            const apiBaseUrl = prompt('Enter the Azure Function app base URL', window.apiBaseUrl);

            function getConnectionInfo() {
                return axios.post(`${apiBaseUrl}/api/negotiate?username=${username}&hubname=banking`, null, getAxiosConfig())
                    .then(resp => resp.data);
            }

            function getAxiosConfig() {
                const config = {
                    headers: { 'x-ms-signalr-userid': username }
                };
                return config;
            }


            (function () {
                getConnectionInfo().then(info => {
                    // make compatible with old and new SignalRConnectionInfo
                    info.accessToken = info.accessToken || info.accessKey;
                    info.url = info.url || info.endpoint;
                    const options = {
                        accessTokenFactory: () => info.accessToken
                    };
                    const connection = new signalR.HubConnectionBuilder()
                        .withUrl(info.url, options)
                        .configureLogging(signalR.LogLevel.Information)
                        .build();
                    connection.on('newMessage', function (message) { console.log(message); });
                    connection.on('accounts', function (message) { console.log(message); });
                    connection.on('account', function (info) { console.log(info); })
                    connection.onclose(() => console.log('disconnected'));
                    connection.on
                    console.log('connecting...');
                    connection.start()
                        .then(() => console.log('connected!'))
                        .catch(console.error);
                }).catch(alert);


            })();


        </script>
</body>

</html>